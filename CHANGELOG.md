# Changelog

Все заметные изменения в проекте grandFW будут задокументированы в этом файле.

## [3.0.0] - 2026-01-19

### Added
- Создана модульная архитектура с разделением на библиотеки:
  - `lib/common.sh` - общие функции (логирование, проверки, backup)
  - `lib/validation.sh` - валидация данных (UUID, IP, порты)
  - `lib/crypto.sh` - криптографические функции
  - `lib/env_loader.sh` - безопасная загрузка .env
  - `lib/docker.sh` - работа с Docker
  - `lib/firewall.sh` - настройка UFW
- Добавлены unit тесты для всех библиотек
- Добавлены integration тесты
- Созданы скрипты для обновления, резервного копирования и удаления
- Добавлена полная CI/CD инфраструктура (GitHub Actions)
- Добавлена документация по архитектуре и устранению неполадок
- Добавлены скрипты управления: `scripts/update.sh`, `scripts/backup.sh`, `scripts/uninstall.sh`
- Добавлена система тестирования с тестами для всех компонентов
- Добавлены планы реализации: `docs/PLAN_01_LIBRARIES.md`, `docs/PLAN_02_CRITICAL_FIXES.md`, `docs/PLAN_03_TESTING.md`, `docs/PLAN_04_CICD.md`

### Changed
- Рефакторинг setup.sh с использованием модульной архитектуры
- Замена unsafe загрузки переменных окружения на безопасную через `load_env_safe()`
- Исправление конфликта портов (VLESS использует 8443, Shadowsocks 9443)
- Добавление порта AmneziaWG (51820/udp) в UFW правила
- Исправление Endpoint в AmneziaWG конфиге (теперь использует реальный IP)
- Установка прав доступа 600 для .env файла
- Переход на новую архитектуру с директорией `scripts/` для исполняемых файлов
- Обновление документации с учетом новых изменений
- Использование проектного имени "grandfw" в Docker Compose

### Fixed
- Уязвимость command injection в загрузке .env файлов
- Конфликт портов между VLESS и Shadowsocks
- Порт AmneziaWG не открывался в firewall
- Некорректный Endpoint в AmneziaWG конфиге
- Небезопасные права доступа к .env файлу
- Отсутствие проверки конфликта портов
- Проблемы с генерацией конфигураций
- Ошибки в обработке путей к файлам
- Проблемы с запуском Docker контейнеров

### Security
- Добавлена защита от command injection
- Установка безопасных прав доступа (600) для конфиденциальных файлов
- Безопасная загрузка переменных окружения
- Валидация всех входных данных
- Проверка целостности конфигурационных файлов

### Refactor
- Разделение монолитного скрипта на модули
- Улучшение структуры проекта
- Добавление типизации и документирования функций
- Улучшение обработки ошибок
- Улучшение логирования

### Tests
- Создание системы unit тестов
- Создание системы integration тестов
- Создание системы E2E тестов
- Добавление тестовых утилит
- Покрытие тестами >80%

## [2.0.0] - 2026-01-18

### Added
- Поддержка протокола VLESS + REALITY
- Поддержка протокола Shadowsocks-2022
- Поддержка протокола AmneziaWG (совместимого с WireGuard)
- Автоматическая генерация криптографических параметров
- Интеграция с Docker и Docker Compose
- Автоматическая настройка брандмауэра UFW
- Генерация QR-кодов для подключения
- Создание файла с инструкциями подключения

## [1.0.0] - 2026-01-17

### Added
- Первоначальная версия мульти-протокольного VPN-сервера
- Поддержка базовых протоколов
- Основной установочный скрипт