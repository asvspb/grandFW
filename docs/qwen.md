Ты — Senior DevOps Engineer и эксперт по сетевой безопасности с 10-летним опытом.
Твоя задача — спроектировать и написать решение для развертывания мульти-протокольного VPN-сервера (VLESS+Reality, Shadowsocks-2022, AmneziaWG) на базе Docker для Ubuntu 22.04+.

Твой код и подход должны соответствовать строгим стандартам Enterprise-разработки ("Best Practices").

### 1. Архитектурные требования (Infrastructure as Code)
*   **Контейнеризация:** Использовать `docker-compose.yml`. Все сервисы должны быть изолированы.
*   **Конфигурация:** Никаких хардкода (hardcoded values) в коде. Все переменные (порты, пароли, ключи, версии образов) должны выноситься в файл `.env`.
*   **Идемпотентность:** Скрипт установки должен быть идемпотентным. Повторный запуск скрипта не должен ломать сервер, а должен проверять состояние и обновлять конфигурацию при необходимости.
*   **Безопасность:**
    *   Автоматическая генерация криптостойких ключей и паролей (openssl rand и т.д.) при первом запуске.
    *   Минимальные привилегии для контейнеров (где возможно).
    *   Настройка Firewall (UFW) в рамках скрипта (открытие только нужных портов).

### 2. Требования к коду (Bash Scripting)
*   Напиши единый управляющий скрипт `setup.sh` (или `manage.sh`).
*   Используй `set -euo pipefail` для строгого режима обработки ошибок.
*   Код должен быть модульным (функции для проверки зависимостей, генерации конфигов, старта контейнеров).
*   **Логирование:** Скрипт должен писать логи о каждом шаге в консоль с временными метками и уровнями (INFO, WARN, ERROR).
*   **Проверка окружения:** Перед установкой скрипт должен проверить наличие Docker, curl, openssl и прав root. Если чего-то нет — установить или вывести ошибку.

### 3. Функциональные требования
*   **Xray-core:** Настроить один сервис Xray, который слушает 443 порт (VLESS-Reality) и дополнительный порт для Shadowsocks-2022.
*   **AmneziaWG:** Отдельный контейнер. Настроить генерацию параметров (Jc, Jmin, Jmax, S1, S2, H1-H4) для защиты от DPI.
*   **Вывод данных:** После успешной установки скрипт должен:
    1. Сгенерировать JSON-вывод с данными для подключения.
    2. Вывести в консоль готовые URI ссылки (`vless://`, `ss://`) и конфиг Amnezia.
    3. (Опционально) Сгенерировать QR-коды в терминале (используя `qrencode`, если есть, или docker-образ).

### 4. Тестирование и Валидация
*   Включи в скрипт функцию `health_check`, которая:
    *   Проверяет статус контейнеров (`docker compose ps`).
    *   Делает тестовый запрос внутри контейнера (например, `xray run -test`).
    *   Проверяет доступность внешнего IP.

### 5. Документация (README.md)
Создай файл `README.md`, который включает:
*   **Prerequisites:** Что нужно перед запуском (OS, порты).
*   **Quick Start:** Одна команда для запуска.
*   **Architecture:** Описание используемых контейнеров и сетей.
*   **Client Setup:** Инструкция, как подключить клиенты (v2rayNG, AmneziaVPN, Hiddify).
*   **Troubleshooting:** Что делать, если не подключается.

### Итоговый результат
Предоставь полный набор файлов:
1. `docker-compose.yml`
2. `.env.template`
3. Шаблоны конфигов (папка `configs/`)
4. `setup.sh` (полный код)
5. `README.md`